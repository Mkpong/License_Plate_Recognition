# 프로젝트 정리

## 1. 프로젝트 개요

### 프로젝트 명

- 인공지능을 활용한 번호판 인식 및 주차장 관리 시스템(소프트웨어)

### 프로젝트 설명

- 상용화된 주차장 입출차 관리 시스템을 직접 구현
- 웹에서 관리자가 차량의 입, 출차 기록을 관리하고 장기 주차 등의 특이사항을 확인할 수 있다.

### 개발 기간

- 2023.06.22 ~ 2023.07.14
    - Yolo를 통한 자동차 번호판 부분 검출
    - 이미지 처리(Contour기반) 또는 Yolo를 통한 번호판 내부 숫자 및 문자 검출
    - ResNet 모델을 통해 숫자, 문자 인식
- 2023.07.17 ~ 2023.07.28
    - 데이터 처리 및 저장 , 사용자 UI 구현
    - 서비스 기능 구현
- 2023.07.31 ~ 2023.08.11
    - 핸드폰 어플리케이션 연동 및 성능 개선(모델 속도)

### 프로그램 구성도

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled.png)

---

## 2. 구현 기능

### (1) 번호판 인식

- 번호판 부분 crop image 검출
- crop image에서 숫자 및 문자 검출.
- 숫자 및 문자 인식

### (2) 데이터 처리 및 저장

- 번호판 인식 프로그램에서 넘어온 차량번호 데이터 처리
- 미리 정해둔 규칙에 따라 주차 요금 계산
    - 장애인 차량으로 등록된 차량과 같은 차량은 다르게 적용
- 만차 시 더이상 차량이 들어올 수 없도록 처리

### (3) 사용자 UI

- 관리자는 과거 주차 차량 또는 현재 주차된 차량의 정보를 실시간으로 확인
    - 특이사항이 있는 차량은 별도로 확인

---

## 3. 데이터베이스

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%201.png)

---

## 4. 구현 방법 및 세부내용

### (1) 번호판 인식

- 번호판 검출(cropImage1)
    - YoloV5를 이용해 검출
- cropImage1에서 문자 및 숫자 검출
    1. 이미지 처리(contour기반)으로 검출
        - contour을 통해 번호판 후보군 생성 → 번호판의 숫자 및 문자는 일정한 규칙을 가지고 나열되어 있음
        - 최적의 인식률을 가지도록 촬영 환경에 따라 변수, 조건등을 지속해서 수정해주어야 함
        - 번호판의 왜곡 또는 회전 빛 반사에 의해 오검출 빈도가 높음
        - 한글을 검출할 때 자음+모음으로 분리되어 검출되는 문제가 발생
            - 아래와 같이 자음 + 모음으로 검출되면 특정 비율로 위아래 또는 좌우로 붙어 있는 사각형을 합친 후 숫자들의 평균 너비 및 높이 비율에 따라 후보군에 추가할지 말지 결정
            
            ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%202.png)
            
    
    1. Yolo를 통해 문자 및 숫자 검출 ← **해당 방법 사용**
        - 동일한 데이터를 이용해 Yolov4-tiny와 Yolov5s 모델을 학습한 결과 yolov5s가 월등한 성능을 보여줌 → 이유가?
    2. CNN 모델인 Resnet-18을 사용해 숫자 및 문자 인식
        - 가~주 / 0~9 각각 두 모델을 학습(각 글자, 숫자마다 50~200장 사용)
        - 번호판의 특성에 따라 한글은 뒤에서 4번째에 존재하기 때문에 뒤에서 4번째 항목만 한글 모델로 인식 → 자가용 번호판의 경우 ← **해당 방법 사용(데이터가 많아지면 아래의 방법으로 변경 가능)**
        - 또는 위의 2번 과정에서 숫자, 문자를 분리하여 검출해 검출 후 번호판을 다시 완성시키는 방법
        - Resnet-18 모델 형식

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%203.png)

| 경기 | 경기 | 서울 | 서울 | 인천 | 인천 |
| --- | --- | --- | --- | --- | --- |
| 0 | 1 | 2 | 3 | 4 | 5 |

```c
model = models.resnet18(weights=None)
model.conv1 = nn.Conv2d(3, 64, kernel_size=7, stride=2, padding=3, bias=False)
model.fc = nn.Linear(512, 10)

model2 = models.resnet18(weights=None)
model2.conv1 = nn.Conv2d(3,64, kernel_size=7, stride=2, padding=3, bias=False)
model2.fc=nn.Linear(512,32)
```

### (2) 데이터 처리 및 저장

- 입차 기록이 있다면 출차로, 없다면 입차로 처리
    
    → 실제 적용된다면 들어가는 곳과 나가는 곳이 다르기 때문에 구분 X
    
- 출차 시 미리 정해준 요금 기준에 따라 요금 부과
- 정기권과 같은 차량 구분
    - 입차 시 정기권차량 DB에 해당 차량번호가 존재하면 정기권DB의 ID값을 저장하고 출차 시 요금 부과 X
    - 정기권 DB에 자동 연장(결제) 여부 저장
- 장애인 스티커 부착 차량 등 우대 차량 관리
    - 입차 시 우대차량 DB에 해당 차량번호가 존재하면 우대DB의 ID값을 저장하고 추후 요금 정산시 반영하여 계산

### (3) 사용자 UI

- 관리자가 주차장의 입차 및 출차 차량을 관리할 수 있음
- 특이사항이 있는 차량은 별도로 표시(장기 주차 등)
    
    → 일정 기간을 두고 업데이트 진행
    

---

## 5. 문제점 및 개선방안

### 번호판 인식

1. 번호판 부분 추출
    - 데이터셋 보강 (공개된 데이터가 없고 직접 라벨링을 하려고 해도 원본 이미지 또한 구하기 쉽지 않다)
2. 문자 및 숫자 검출
    - Yolo에서 오검출 되는 경우를 생각해서 한번 검수해주는 코드부분 추가
3. 숫자 및 문자 인식
    - (1,7) , (0,8) , (우,무) → 데이터의 부족으로 잘못된 인식이 발생
        
        → 데이터를 최대한 많이 만들어 보고 추후 다른 모델을 사용해보고 성능을 비교
        

## 6. 현재 진행상황

### (1) 번호판 인식

- 국내 자가용 차량 흰색 번호판만 인식 가능 → 7자리 및 8자리(홀로그램 여부 상관x)
    
    → 한글은 자가용에 사용되는 한글인 “가”~”주”만 인식
    
    ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%204.png)
    
    ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%205.png)
    
    ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%206.png)
    
    ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%207.png)
    
    ![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%208.png)
    

### (2) 데이터 처리 및 저장

- Flask에서 넘어온 차량 번호와 시간 데이터를 활용해 입, 출차 구분 및 요금 계산까지 구현
    
    → Test 과정에서 편의성을 위해 15초에 요금은 1500원씩 증가
    

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%209.png)

         → Parking_Car DB

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%2010.png)

                                 → Recode DB

### (3) 사용자 UI(구현중)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%2011.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%2012.png)

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%20%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5%203bd563316dea49b99fafbdbe228930b2/Untitled%2013.png)

## 비고

- 이후 영업용 번호판 및 구 녹색 번호판에 대한 인식을 여유가 있다면 진행할 예정
- 카메라(HW) 부분은 일단 기존에 촬영된 이미지를 넣어서 Test
    
    → 이후 프로그램을 서버에 올려보고 가능하다면 폰에서 촬영한 사진을 Flask서버로 넘겨서 입, 출차 인식 처럼 구현 가능한 간단한 어플리케이션을 만들어 Test예정
    

- 지역 train, test 다시 학습 → 인식률 확인
- 단어 test → 인식률 확인
- resnet 18, yolo v4, v5 공부

이미지 처리로 하면 회전 및 번호판 오염에 약함